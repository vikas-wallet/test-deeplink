<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeplink Redirect</title>
</head>
<body>
    <script>
        var appURL = "rakutenwalletweb3://";
        var appOpened = false;
        var previousPage = document.referrer;

        function redirectToPreviousPage() {
            console.log("Attempting to redirect to:", previousPage); // Debugging
            if (previousPage) {
                // Use window.history.back() as a more reliable alternative
                window.history.back();
            } else {
                console.warn("Previous page is empty.  Providing fallback."); // Debugging
                alert("Could not determine previous page. Please navigate back manually.");
            }
        }

        function showAlert() {
            alert("Rakuten Wallet Web3 app may not be installed. Click OK to return to the previous page.");
            redirectToPreviousPage();
        }

        function checkAppOpen() {
            if (!appOpened) {
                showAlert();
            }
        }

        function handleAppOpen() {
            appOpened = true;
        }

        function openApp() {
            window.location.replace(appURL);
            setTimeout(checkAppOpen, 2000);
        }

        // Event listeners
        window.addEventListener('pagehide', handleAppOpen);
        window.addEventListener('blur', handleAppOpen);

        // Debugging: Log the referrer immediately
        console.log("Initial document.referrer:", document.referrer);

        openApp();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeplink Redirect</title>
</head>
<body>
    <script>
        var appURL = "rakutenwalletweb3://";
        var appOpened = false;
        var previousPage = document.referrer;

        function redirectToPreviousPage() {
            if (previousPage) {
                window.location.href = previousPage;
            } else {
                alert("Could not determine previous page. Please navigate back manually.");
            }
        }

        function showAlert() {
            alert("Rakuten Wallet Web3 app may not be installed. Click OK to return to the previous page.");
            redirectToPreviousPage();
        }

        // Use a more robust method for checking if the app opened
        function checkAppOpen() {
            if (!appOpened) {
                showAlert();
            }
        }

        function handleAppOpen() {
            appOpened = true;
            // No need to clear the timer here, let it expire naturally
        }

        // Attempt to open the app
        function openApp() {
            window.location.replace(appURL);

            // Start a timer to check if the app opened after a delay
            setTimeout(checkAppOpen, 2000); // Increased delay to 2 seconds
        }

        // Event listeners (using a more reliable approach)
        window.addEventListener('pagehide', handleAppOpen); // Use pagehide
        window.addEventListener('blur', handleAppOpen);

        // Initial attempt to open the app
        openApp();
    </script>
</body>
</html>
